<!DOCTYPE HTML>
<!--
	Forty by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
    <title>제품 생산 공정</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/assets/css/main.css" />
    <noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        #banner {
            height: 25vh;
        }

        .content-left {
            width: 30%;
        }

        .content-right {
            width: 50%;
        }

        .dived-content-box {
            width: 100%;
            display: flex;
            gap: 2em;
            justify-content: space-evenly;
        }

        .apexcharts-legend-text {
          color: #ffffff !important;
        }

        .apexcharts-text {
          color: #ffffff !important;
        }

        .process-page-box {
            display: flex;
            width: 45em;
            align-items: center;
            gap: 0.5em;
        }

        .process-page-right {
            margin-left: 2em;
        }

        .process-content {
            width: 100%;
        }

        .part-content {
            width: 100%;
            transition: 0.5s;
        }

        .product-content {
            width: 100%;
            display: none;
            transition: 0.5s;
        }

        .work-rate-content {
            width: 100%;
            display: none;
            transition: 0.5s;
        }

        .content-information-box {
            height: 33em;
        }


    </style>
</head>
<body class="is-preload">

<!-- Wrapper -->
<div id="wrapper">

    <!-- Header -->
    <!-- Note: The "styleN" class below should match that of the banner element. -->
    <header id="header" class="alt style2">
        <a href="/main" class="logo"><strong>메인 페이지</strong></a>
        <nav>
            <a id="login-button" href="#login">로그인</a>
            <a href="#menu">메뉴</a>
        </nav>
    </header>

    <!-- Menu -->
    <nav id="menu">
        <ul class="links">
            <li><a href="/main">메인페이지</a></li>
            <li><a href="/production/production_process">제품 생산 공정</a></li>
            <li><a href="/sales/correspondent_material_management">거래처 관리</a></li>
            <li><a href="/notice">공지사항</a></li>
            <li><a href="/sales_management">재무?</a></li>
        </ul>
        <ul class="actions stacked">
            <li><a href="/accession" class="button primary join">회원가입</a></li>
        </ul>
    </nav>
    <!-- Banner -->
    <!-- Note: The "styleN" class below should match that of the header element. -->
    <section id="banner" class="style2">
        <div class="inner">
							<span class="image">
								<img src="/images/pic07.jpg" alt="" />
							</span>
            <header class="major">
                <h1>제품 생산 공정</h1>
            </header>
            <div class="content">
                <p>이용자 환영인사<br />
                    오늘도 힘찬 하루 보내세요!</p>
            </div>
        </div>
    </section>

    <!-- login -->
    <nav id="login">
        <ul class="links">
            <form action="/login" method="post"><!-- 서버로 post 요청 -->
                <h4 class="login_logo"><strong>Forty by HTML5 UP</strong></h4>
                <br>
                <li>ID<input type="text" name="monami_id" required></li> <!--name이 모나미_아이디로 전송 -->
                <li>PassWord<input type="text" name="monami_password" required></li> <!--name이 모나미_비번으로 전송 -->
                <!-- required = 사용자가 빈값으로 제출하는거 방지 -->
                <br>
                <li><button >Login</button></li>
                <br>
            </form>
        </ul>
    </nav>

    <!-- Main -->
    <div id="main">

        <!-- One -->
        <section id="contect">
            <div class="inner dived-content-box" style="margin-left: 1em;">
                <section class="content-left">
                    <div class="process-content">
                        <div class="inner">
                            <header class="major">
                                <h3>원자재 현황</h3>
                            </header>
                        </div>

                        <!-- Column Chart -->
                        <div id="columnChart"></div>

                        <script th:inline="javascript">
                            let materialHoldingsData = /*[[${MaterialHoldingsList}]]*/ [];

                            document.addEventListener("DOMContentLoaded", () => {

                                let today = new Date();
                                let oneWeekAgo = new Date();
                                oneWeekAgo.setDate(today.getDate() - 51);

                                let groupedData = {};

                                materialHoldingsData.forEach(item => {
                                    let materialId = item.materialId.materialId;
                                    let quantity = item.quantity;
                                    let date = new Date(item.holdingsDate);

                                    if (date >= oneWeekAgo && date <= today) {
                                        if (!groupedData[materialId]) {
                                            groupedData[materialId] = {
                                                name: `Material ${materialId}`,
                                                data: []
                                            };
                                        }

                                        groupedData[materialId].data.push({ date: date, quantity: quantity });
                                    }
                                });

                                let seriesData = Object.values(groupedData).map(item => ({
                                    name: item.name,
                                    data: item.data.map(d => d.quantity)
                                }));

                                let categoriesData = materialHoldingsData
                                    .map(item => new Date(item.holdingsDate).toLocaleDateString())
                                    .filter((date, index, self) => {
                                        let dateObj = new Date(date);
                                        return dateObj >= oneWeekAgo && dateObj <= today && self.indexOf(date) === index;
                                    });

                                new ApexCharts(document.querySelector("#columnChart"), {
                                    series: seriesData,
                                    chart: {
                                        type: 'bar',
                                        height: 350
                                    },
                                    xaxis: {
                                        categories: categoriesData,
                                        labels: { style: { colors: "#ffffff" } }
                                    },
                                    yaxis: {
                                        labels: { style: { colors: "#ffffff" } },
                                        title: {
                                            text: 'Quantity',
                                            style: { color: "#ffffff" }
                                        }
                                    },
                                    fill: {
                                        opacity: 1
                                    },
                                    dataLabels: {
                                        enabled: false
                                    },
                                    tooltip: {
                                        theme: "dark",
                                        y: {
                                            formatter: function(val) {
                                                return val + " units";
                                            }
                                        }
                                    }
                                }).render();
                            });
                        </script>
                        <!-- End Column Chart -->

                    </div>
                </section>

                <section class="content-right">
                    <div class="process-content">
                        <div class="process-page-box">
                            <button class="process-page-button process-page-left">왼</button>
                            <!-- 부품 데이터 -->
                            <div class="dived-content-box part-content">
                                <div class="content-information-box">
                                    <header class="major">
                                        <h3>생산품 현황</h3>
                                    </header>
                                    <button class="line-chart-change">전환</button><br>
                                    현재 생산량<br>
                                    목표 생산량<br>
                                    불량품 비율<br>
                                    일일 생산량<br>

                                </div>

                                <!-- Line Chart -->
                                <div id="lineChart"></div>

                                <script th:inline="javascript">
                                    let monamipenbodyList = /*[[${monamiPenbodyList}]]*/ [];
                                    let monamipenheadList = /*[[${monamiPenheadList}]]*/ [];
                                    let monamirubberList = /*[[${monamiRubberList}]]*/ [];

                                    function createLineChart() {
                                        let today = new Date();
                                        let oneWeekAgo = new Date();
                                        oneWeekAgo.setDate(today.getDate() - 7);

                                        let groupedData = {};

                                        monamipenbodyList.forEach(item => {
                                            let penbody_daily_amount = item.penbodyDailyAmount;
                                            let date = new Date(item.penbodyDate);

                                            if (date >= oneWeekAgo && date <= today) {
                                                if (!groupedData['penbody']) {
                                                    groupedData['penbody'] = {
                                                        name: 'penbody',
                                                        data: []
                                                    };
                                                }

                                                groupedData['penbody'].data.push({ date: date, daily_amount: penbody_daily_amount });
                                            }
                                        });

                                        monamipenheadList.forEach(item => {
                                            let penhead_daily_amount = item.penheadDailyAmount;
                                            let date = new Date(item.penheadDate);

                                            if (date >= oneWeekAgo && date <= today) {
                                                // part별로 그룹화
                                                if (!groupedData['penhead']) {
                                                    groupedData['penhead'] = {
                                                        name: 'penhead',
                                                        data: []
                                                    };
                                                }

                                                groupedData['penhead'].data.push({ date: date, daily_amount: penhead_daily_amount });
                                            }
                                        });

                                        monamirubberList.forEach(item => {
                                            let rubber_daily_amount = item.rubberDailyAmount;
                                            let date = new Date(item.rubberDate);

                                            if (date >= oneWeekAgo && date <= today) {
                                                if (!groupedData['rubber']) {
                                                    groupedData['rubber'] = {
                                                        name: 'rubber',
                                                        data: []
                                                    };
                                                }

                                                groupedData['rubber'].data.push({ date: date, daily_amount: rubber_daily_amount });
                                            }
                                        });

                                        let seriesData = Object.values(groupedData).map(item => ({
                                            name: item.name,
                                            data: item.data.map(d => d.daily_amount)
                                        }));

                                        let categoriesData = monamipenbodyList
                                            .map(item => new Date(item.penbodyDate).toLocaleDateString())
                                            .filter((date, index, self) => {
                                                let dateObj = new Date(date);
                                                return dateObj >= oneWeekAgo && dateObj <= today && self.indexOf(date) === index;
                                            });

                                        window.lineChart = new ApexCharts(document.querySelector("#lineChart"), {
                                            series: seriesData,
                                            chart: {
                                                height: 500,
                                                width: 400,
                                                type: 'line',
                                                zoom: {
                                                    enabled: false
                                                }
                                            },
                                            dataLabels: {
                                                enabled: false
                                            },
                                            stroke: {
                                                curve: 'straight'
                                            },
                                            grid: {
                                                row: {
                                                    colors: ['#f3f3f3', 'transparent'],
                                                    opacity: 0.5
                                                },
                                            },
                                            xaxis: {
                                                categories: categoriesData,
                                                labels: { style: { colors: "#ffffff" } },
                                                title: { style: { colors: "#ffffff" } }
                                            },
                                            yaxis: {
                                                labels: { style: { colors: "#ffffff" } },
                                                title: { style: { colors: "#ffffff" } }
                                            },
                                            legend: {
                                                labels: { colors: "#ffffff" }
                                            },
                                            tooltip: {
                                                theme: "dark",
                                                style: {
                                                    colors: ["#ffffff"]
                                                }
                                            }
                                        });
                                        window.lineChart.render();
                                    }

                                    document.addEventListener("DOMContentLoaded", () => {
                                        createLineChart();
                                    });

                                </script>
                                <!-- End Line Chart -->
                            </div>

                            <!-- 제조품 데이터-->
                            <div class="dived-content-box product-content">
                                <div class="content-information-box">
                                    <header class="major">
                                        <h3>생산품 현황</h3>
                                    </header>
                                    <button class="line-chart-change">전환</button><br>
                                    현재 생산량<br>
                                    목표 생산량<br>
                                    불량품 비율<br>
                                    일일 생산량<br>

                                </div>

                                <!-- Area Chart -->
                                <div id="areaChart"></div>

                                <script th:inline="javascript">
                                    let monamitotalpenList = /*[[${monamiTotalpenList}]]*/ [];
                                    let monamitotalpenAmount = [[${monamiTotalpenAmount}]];

                                    function createAreaChart() {
                                        let today = new Date();
                                        let oneWeekAgo = new Date();
                                        oneWeekAgo.setDate(today.getDate() - 7);

                                        let groupedData = {};

                                        monamitotalpenList.forEach(item => {
                                            let totalpen_amount = item.totalpenAmount;
                                            let date = new Date(item.totalpenDate);

                                            if (date >= oneWeekAgo && date <= today) {
                                                if (!groupedData['totalpen']) {
                                                    groupedData['totalpen'] = {
                                                        name: 'totalpen',
                                                        data: []
                                                    };
                                                }

                                                groupedData['totalpen'].data.push({ date: date, daily_amount: totalpen_amount });
                                            }
                                        });

                                        let seriesData = Object.values(groupedData).map(item => ({
                                            name: item.name,
                                            data: item.data.map(d => d.daily_amount)
                                        }));

                                        let categoriesData = monamitotalpenList
                                            .map(item => new Date(item.totalpenDate).toLocaleDateString())
                                            .filter((date, index, self) => {
                                                let dateObj = new Date(date);
                                                return dateObj >= oneWeekAgo && dateObj <= today && self.indexOf(date) === index;
                                            });

                                        window.areaChart = new ApexCharts(document.querySelector("#areaChart"), {
                                            series: seriesData,
                                            chart: {
                                                type: 'area',
                                                height: 350,
                                                zoom: {
                                                    enabled: false
                                                },
                                                foreColor: '#ffffff'
                                            },
                                            dataLabels: {
                                                enabled: false
                                            },
                                            stroke: {
                                                curve: 'straight'
                                            },
                                            subtitle: {
                                                text: 'Price Movements',
                                                align: 'left',
                                                style: { color: '#ffffff' }
                                            },
                                            labels: categoriesData,
                                            xaxis: {
                                                type: 'datetime',
                                                labels: { style: { color: '#ffffff' } },
                                                title: { style: { color: '#ffffff' } }
                                            },
                                            yaxis: {
                                                opposite: true,
                                                labels: { style: { color: '#ffffff' } },
                                                title: { style: { color: '#ffffff' } }
                                            },
                                            legend: {
                                                horizontalAlign: 'left',
                                                labels: { style: { color: '#ffffff' } }
                                            },
                                            tooltip: {
                                                theme: "dark",
                                                style: {
                                                    colors: ["#ffffff"]
                                                }
                                            }
                                        });

                                        window.areaChart.render();
                                    };

                                    document.addEventListener("DOMContentLoaded", () => {
                                        createAreaChart();
                                    });
                                </script>
                                <!-- End Area Chart -->
                            </div>

                            <!-- 작업률 데이터 -->
                            <div class="dived-content-box work-rate-content">
                                <div class="content-information-box">
                                    <header class="major">
                                        <h3>생산품 현황</h3>
                                    </header>
                                    <button class="line-chart-change">전환</button><br>
                                    현재 생산량<br>
                                    목표 생산량<br>
                                    불량품 비율<br>
                                    일일 생산량<br>

                                </div>

                                <!-- Radial Bar Chart -->
                                <div id="radialBarChart"></div>

                                <script th:inline="javascript">
                                    function createRadialBarChart() {
                                        let today = new Date();
                                        today.setHours(0, 0, 0, 0);

                                        let todayData_penbody = monamipenbodyList.filter(item => {
                                            let itemDate = new Date(item.penbodyDate);
                                            itemDate.setHours(0, 0, 0, 0);
                                            return itemDate.getTime() === today.getTime();
                                        });
                                        let todayAmounts_penbody = todayData_penbody.map(item => item.penbodyDailyAmount);
                                        let todayAmount_penbody = todayAmounts_penbody.length > 0 ? todayAmounts_penbody[0] : null;
                                        let todayDailyProductions_penbody = todayData_penbody.map(item => item.penbodyDailyProduction);
                                        let todayDailyProduction_penbody = todayDailyProductions_penbody.length > 0 ? todayDailyProductions_penbody[0] : null;

                                        penbody_work_rate = Math.floor((todayAmount_penbody / todayDailyProduction_penbody) * 100);
                                        if (penbody_work_rate > 100) penbody_work_rate = 100;

                                        let todayData_penhead = monamipenheadList.filter(item => {
                                            let itemDate = new Date(item.penheadDate);
                                            itemDate.setHours(0, 0, 0, 0);
                                            return itemDate.getTime() === today.getTime();
                                        });
                                        let todayAmounts_penhead = todayData_penhead.map(item => item.penheadDailyAmount);
                                        let todayAmount_penhead = todayAmounts_penhead.length > 0 ? todayAmounts_penhead[0] : null;
                                        let todayDailyProductions_penhead = todayData_penhead.map(item => item.penheadDailyProduction);
                                        let todayDailyProduction_penhead = todayDailyProductions_penhead.length > 0 ? todayDailyProductions_penhead[0] : null;

                                        penhead_work_rate = Math.floor((todayAmount_penhead / todayDailyProduction_penhead) * 100);
                                        if (penhead_work_rate > 100) penhead_work_rate = 100;

                                        let todayData_rubber = monamirubberList.filter(item => {
                                            let itemDate = new Date(item.rubberDate);
                                            itemDate.setHours(0, 0, 0, 0);
                                            return itemDate.getTime() === today.getTime();
                                        });
                                        let todayAmounts_rubber = todayData_rubber.map(item => item.rubberDailyAmount);
                                        let todayAmount_rubber = todayAmounts_rubber.length > 0 ? todayAmounts_rubber[0] : null;
                                        let todayDailyProductions_rubber = todayData_rubber.map(item => item.rubberDailyProduction);
                                        let todayDailyProduction_rubber = todayDailyProductions_rubber.length > 0 ? todayDailyProductions_rubber[0] : null;

                                        rubber_work_rate = Math.floor((todayAmount_rubber / todayDailyProduction_rubber) * 100);
                                        if (rubber_work_rate > 100) rubber_work_rate = 100;

                                        let todayData_totalpen = monamitotalpenList.filter(item => {
                                            let itemDate = new Date(item.totalpenDate);
                                            itemDate.setHours(0, 0, 0, 0);
                                            return itemDate.getTime() === today.getTime();
                                        });
                                        let todayAmounts_totalpen = todayData_totalpen.map(item => item.totalpenAmount);
                                        let todayAmount_totalpen = todayAmounts_totalpen.length > 0 ? todayAmounts_totalpen[0] : null;
                                        let todayDailyProductions_totalpen = todayData_totalpen.map(item => item.totalpenDailyProduction);
                                        let todayDailyProduction_totalpen = todayDailyProductions_totalpen.length > 0 ? todayDailyProductions_totalpen[0] : null;

                                        totalpen_work_rate = Math.floor((todayAmount_totalpen / todayDailyProduction_totalpen) * 100);
                                        if (totalpen_work_rate > 100) totalpen_work_rate = 100;

                                        window.radialBarChart = new ApexCharts(document.querySelector("#radialBarChart"), {
                                            series: [penbody_work_rate, penhead_work_rate, rubber_work_rate, totalpen_work_rate],
                                            chart: {
                                                height: 350,
                                                type: 'radialBar',
                                                toolbar: {
                                                    show: true
                                                }
                                            },
                                            plotOptions: {
                                                radialBar: {
                                                    dataLabels: {
                                                        name: {
                                                            fontSize: '22px',
                                                            color: '#ffffff'
                                                        },
                                                        value: {
                                                            fontSize: '16px',
                                                            color: '#ffffff'
                                                        },
                                                        total: {
                                                            show: true,
                                                            label: 'Total',
                                                            color: '#ffffff',
                                                            formatter: function(w) {
                                                                return monamitotalpenAmount;
                                                            }
                                                        },
                                                        tooltip: {
                                                            theme: "dark",
                                                            style: {
                                                                colors: ["#ffffff"]
                                                            }
                                                        }
                                                    }
                                                }
                                            },
                                            labels: ['Penbody', 'Penhead', 'Rubber', 'Pen'],
                                        });

                                        window.radialBarChart.render();
                                    };
                                    document.addEventListener("DOMContentLoaded", () => {
                                        createRadialBarChart();
                                    });
                                </script>
                                <!-- End Radial Bar Chart -->
                            </div>
                            <button class="process-page-button process-page-right">오</button>
                        </div>

                    </div>
                </section>
            </div>
        </section>
    </div>
    </section>

        <!-- Two -->
        <section id="two" class="spotlights">
            <section>
                <a href="/generic.html" class="image">
                    <img src="/images/pic08.jpg" alt="" data-position="center center" />
                </a>
                <div class="content">
                    <div class="inner">
                        <header class="major">
                            <h3>Orci maecenas</h3>
                        </header>
                        <p>Nullam et orci eu lorem consequat tincidunt vivamus et sagittis magna sed nunc rhoncus condimentum sem. In efficitur ligula tate urna. Maecenas massa sed magna lacinia magna pellentesque lorem ipsum dolor. Nullam et orci eu lorem consequat tincidunt. Vivamus et sagittis tempus.</p>
                        <ul class="actions">
                            <li><a href="/generic.html" class="button">Learn more</a></li>
                        </ul>
                    </div>
                </div>
            </section>
            <section>
                <a href="/generic.html" class="image">
                    <img src="/images/pic09.jpg" alt="" data-position="top center" />
                </a>
                <div class="content">
                    <div class="inner">
                        <header class="major">
                            <h3>Rhoncus magna</h3>
                        </header>
                        <p>Nullam et orci eu lorem consequat tincidunt vivamus et sagittis magna sed nunc rhoncus condimentum sem. In efficitur ligula tate urna. Maecenas massa sed magna lacinia magna pellentesque lorem ipsum dolor. Nullam et orci eu lorem consequat tincidunt. Vivamus et sagittis tempus.</p>
                        <ul class="actions">
                            <li><a href="generic.html" class="button">Learn more</a></li>
                        </ul>
                    </div>
                </div>
            </section>
            <section>
                <a href="/generic.html" class="image">
                    <img src="/images/pic10.jpg" alt="" data-position="25% 25%" />
                </a>
                <div class="content">
                    <div class="inner">
                        <header class="major">
                            <h3>Sed nunc ligula</h3>
                        </header>
                        <p>Nullam et orci eu lorem consequat tincidunt vivamus et sagittis magna sed nunc rhoncus condimentum sem. In efficitur ligula tate urna. Maecenas massa sed magna lacinia magna pellentesque lorem ipsum dolor. Nullam et orci eu lorem consequat tincidunt. Vivamus et sagittis tempus.</p>
                        <ul class="actions">
                            <li><a href="/generic.html" class="button">Learn more</a></li>
                        </ul>
                    </div>
                </div>
            </section>
        </section>

        <!-- Three -->
        <section id="three">
            <div class="inner">
                <header class="major">
                    <h2>Massa libero</h2>
                </header>
                <p>Nullam et orci eu lorem consequat tincidunt vivamus et sagittis libero. Mauris aliquet magna magna sed nunc rhoncus pharetra. Pellentesque condimentum sem. In efficitur ligula tate urna. Maecenas laoreet massa vel lacinia pellentesque lorem ipsum dolor. Nullam et orci eu lorem consequat tincidunt. Vivamus et sagittis libero. Mauris aliquet magna magna sed nunc rhoncus amet pharetra et feugiat tempus.</p>
                <ul class="actions">
                    <li><a href="generic.html" class="button next">Get Started</a></li>
                </ul>
            </div>
        </section>

    </div>

    <!-- Contact -->
    <section id="contact">
        <div class="inner">
            <section>
                <form method="post" action="#">
                    <div class="fields">
                        <div class="field half">
                            <label for="name">Name</label>
                            <input type="text" name="name" id="name" />
                        </div>
                        <div class="field half">
                            <label for="email">Email</label>
                            <input type="text" name="email" id="email" />
                        </div>
                        <div class="field">
                            <label for="message">Message</label>
                            <textarea name="message" id="message" rows="6"></textarea>
                        </div>
                    </div>
                    <ul class="actions">
                        <li><input type="submit" value="Send Message" class="primary" /></li>
                        <li><input type="reset" value="Clear" /></li>
                    </ul>
                </form>
            </section>
            <section class="split">
                <section>
                    <div class="contact-method">
                        <span class="icon solid alt fa-envelope"></span>
                        <h3>Email</h3>
                        <a href="#">information@untitled.tld</a>
                    </div>
                </section>
                <section>
                    <div class="contact-method">
                        <span class="icon solid alt fa-phone"></span>
                        <h3>Phone</h3>
                        <span>(000) 000-0000 x12387</span>
                    </div>
                </section>
                <section>
                    <div class="contact-method">
                        <span class="icon solid alt fa-home"></span>
                        <h3>Address</h3>
                        <span>1234 Somewhere Road #5432<br />
										Nashville, TN 00000<br />
										United States of America</span>
                    </div>
                </section>
            </section>
        </div>
    </section>

    <!-- Footer -->
    <footer id="footer">
        <div class="inner">
            <ul class="icons">
                <li><a href="#" class="icon brands alt fa-twitter"><span class="label">Twitter</span></a></li>
                <li><a href="#" class="icon brands alt fa-facebook-f"><span class="label">Facebook</span></a></li>
                <li><a href="#" class="icon brands alt fa-instagram"><span class="label">Instagram</span></a></li>
                <li><a href="#" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
                <li><a href="#" class="icon brands alt fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
            </ul>
            <ul class="copyright">
                <li>&copy; Untitled</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li>
            </ul>
        </div>
    </footer>

</div>

<!-- Scripts -->
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/jquery.scrolly.min.js"></script>
<script src="/assets/js/jquery.scrollex.min.js"></script>
<script src="/assets/js/browser.min.js"></script>
<script src="/assets/js/breakpoints.min.js"></script>
<script src="/assets/js/util.js"></script>
<script src="/assets/js/main.js"></script>

<script>
    window.onload = function () {
    handleUrlParams(); 	// URL 파라미터 처리
    checkLoginStatus(); // 로그인 상태 확인
    };

    // URL 파라미터 처리
    function handleUrlParams() {
    const urlParams = new URLSearchParams(window.location.search);

    // 로그인 실패 처리
    if (urlParams.has("error")) {
        alert("로그인에 실패했습니다. 아이디와 비밀번호를 확인하세요.");
        // URL에서 error 파라미터 제거
        history.replaceState({}, null, window.location.pathname);
    }
    else if (urlParams.has("success")) { // 로그인 성공 처리
        alert("어서오세요! 로그인에 성공하셨습니다.");
        // URL에서 success 파라미터 제거
        history.replaceState({}, null, window.location.pathname);
        }
    }

    // 로그인 상태 확인
    function checkLoginStatus() {
    const loginButton = document.getElementById('login-button');

    // 로그인 상태 확인 API 호출
    fetch('/check', { credentials: 'include' })
        .then(response => response.json())
        .then(data => {
            const isLoggedIn = data.isLoggedIn; // JSON에서 로그인 상태 가져오기
            if (isLoggedIn) {
                loginButton.textContent = '로그아웃';
                loginButton.removeAttribute('href'); // href 제거
                loginButton.onclick = function () {
                    handleLogout(); //  로그아웃 처리 호출
                };
            } else {
                updateToLoginButton(loginButton); //  로그인 버튼으로 변경
            }
        })
        .catch(error => {
            console.error('Error:', error);
            updateToLoginButton(loginButton); // 에러 발생 시에도 로그인 버튼으로 변경
        });
    }

    // 로그아웃 처리
    function handleLogout() {
    fetch('/logout', { credentials: 'include' }) // 로그아웃 요청
        .then(() => {
            alert('로그아웃되었습니다.');
            checkLoginStatus(); 					   //로그아웃 후 상태 갱신
        })
        .catch(error => console.error('Error:', error));
    }

    // 로그인 버튼 상태로 업데이트
    function updateToLoginButton(loginButton) {
    loginButton.textContent = '로그인';
    loginButton.setAttribute('href', '#login');
    loginButton.onclick = null;
    }

</script>

<script th:inline="javascript">
    let process_page_now = 1;

    let part_content = document.querySelector(".part-content");
    let product_content = document.querySelector(".product-content");
    let work_rate_content = document.querySelector(".work-rate-content");

    document.querySelector(".process-page-left").addEventListener("click", function (e){
        e.preventDefault();
        e.stopPropagation();

        if(process_page_now === 1) {
            process_page_now = 3;
            part_content.style.display = "none";

            work_rate_content.style.display = "flex";

            window.radialBarChart.destroy();
            createRadialBarChart();
        }
        else if(process_page_now === 2) {
            process_page_now = 1;
            product_content.style.display = "none";

            part_content.style.display = "flex";

            window.lineChart.destroy();
            createLineChart();
        }
        else if(process_page_now === 3) {
            process_page_now = 2;
            work_rate_content.style.display = "none";

            product_content.style.display = "flex";

            window.areaChart.destroy();
            createAreaChart();
        }
    });

    document.querySelector(".process-page-right").addEventListener("click", function (e){
        e.preventDefault();
        e.stopPropagation();

        if(process_page_now === 1) {
            process_page_now = 2;

            part_content.style.display = "none";

            product_content.style.display = "flex";

            window.areaChart.destroy();
            createAreaChart();
        }
        else if(process_page_now === 2) {
            process_page_now = 3;

            product_content.style.display = "none";

            work_rate_content.style.display = "flex";

            window.radialBarChart.destroy();
            createRadialBarChart();
        }
        else if(process_page_now === 3) {
            process_page_now = 1;

            work_rate_content.style.display = "none";

            part_content.style.display = "flex";

            window.lineChart.destroy();
            createLineChart();
        }
    });


</script>

</body>
</html>